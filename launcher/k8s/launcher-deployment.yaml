apiVersion: v1
kind: ServiceAccount
metadata:
  name: launcher
  namespace: default

---
# Single Pod deployment â€” intended for running launcher as a single Pod on a node.
apiVersion: v1
kind: Pod
metadata:
  name: launcher
  namespace: default
  labels:
    app: launcher
spec:
  serviceAccountName: launcher
  containers:
    - name: launcher
      image: "launcher:latest" # replace with your registry/image
      imagePullPolicy: IfNotPresent
      ports:
        - containerPort: 50051
      env:
        - name: RUST_LOG
          value: info
      securityContext:
        # least-privilege: only grant the network and sys_admin capabilities required
        capabilities:
          add: ["NET_ADMIN", "SYS_ADMIN"]
      volumeMounts:
        - name: lxd-socket
          mountPath: /var/snap/lxd/common/lxd/unix.socket
          readOnly: true
  volumes:
    - name: lxd-socket
      hostPath:
        path: /var/snap/lxd/common/lxd/unix.socket
        type: Socket
